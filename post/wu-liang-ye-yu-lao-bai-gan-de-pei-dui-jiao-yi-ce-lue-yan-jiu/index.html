<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>äº”ç²®æ¶²ä¸è€ç™½å¹²çš„é…å¯¹äº¤æ˜“ç­–ç•¥ç ”ç©¶ | æ³‰æ°´å®å’š</title>
<link rel="shortcut icon" href="https://wengsway.github.io/favicon.ico?v=1599987233184">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://wengsway.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="äº”ç²®æ¶²ä¸è€ç™½å¹²çš„é…å¯¹äº¤æ˜“ç­–ç•¥ç ”ç©¶ | æ³‰æ°´å®å’š - Atom Feed" href="https://wengsway.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-117938981-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-117938981-1');
</script>


    <meta name="description" content="æœ¬æ–‡çš„ç ”ç©¶å¯¹è±¡æ˜¯é…’ç±»è¡Œä¸šçš„ 11 åªè‚¡ç¥¨ï¼Œæ•´ä½“æ€è·¯æ˜¯åœ¨ 11 åªè‚¡ç¥¨ä¸­å¯»æ‰¾åæ•´æ€§å¼ºçš„ 2 åªè‚¡ç¥¨ï¼Œç„¶åæ„é€ é…å¯¹äº¤æ˜“ç­–ç•¥å¹¶è¿›è¡Œå›æµ‹ï¼Œæ£€éªŒè¯¥æµ‹ç­–ç•¥çš„æ•ˆæœã€‚
Pairs Tradingï¼Œå³é…å¯¹äº¤æ˜“ç­–ç•¥ï¼Œå…¶åŸºæœ¬åŸç†å°±æ˜¯æ‰¾å‡ºä¸¤åªèµ°åŠ¿ç›¸å…³çš„è‚¡ç¥¨ã€‚è¿™ä¸¤åª..." />
    <meta name="keywords" content="Finance" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://wengsway.github.io">
  <img class="avatar" src="https://wengsway.github.io/images/avatar.png?v=1599987233184" alt="">
  </a>
  <h1 class="site-title">
    æ³‰æ°´å®å’š
  </h1>
  <p class="site-description">
    æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/wengsway" target="_blank">
          <i class="ri-github-line"></i>
        </a>
      
    
      
    
      
        <a href="https://weibo.com/wengsway " target="_blank">
          <i class="ri-weibo-line"></i>
        </a>
      
    
      
    
      
        <a href="https://www.facebook.com/quan.weng" target="_blank">
          <i class="ri-facebook-line"></i>
        </a>
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              äº”ç²®æ¶²ä¸è€ç™½å¹²çš„é…å¯¹äº¤æ˜“ç­–ç•¥ç ”ç©¶
            </h2>
            <div class="post-info">
              <span>
                2018-04-06
              </span>
              <span>
                9 min read
              </span>
              
                <a href="https://wengsway.github.io/tag/hgbstBKWi/" class="post-tag">
                  # Finance
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://i.loli.net/2020/09/13/YPpDc61JAUWGXlK.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>æœ¬æ–‡çš„ç ”ç©¶å¯¹è±¡æ˜¯é…’ç±»è¡Œä¸šçš„ <em>11</em> åªè‚¡ç¥¨ï¼Œæ•´ä½“æ€è·¯æ˜¯åœ¨ <em>11</em> åªè‚¡ç¥¨ä¸­å¯»æ‰¾åæ•´æ€§å¼ºçš„ <em>2</em> åªè‚¡ç¥¨ï¼Œç„¶åæ„é€ é…å¯¹äº¤æ˜“ç­–ç•¥å¹¶è¿›è¡Œå›æµ‹ï¼Œæ£€éªŒè¯¥æµ‹ç­–ç•¥çš„æ•ˆæœã€‚</p>
<p><em>Pairs Trading</em>ï¼Œå³é…å¯¹äº¤æ˜“ç­–ç•¥ï¼Œå…¶åŸºæœ¬åŸç†å°±æ˜¯æ‰¾å‡ºä¸¤åªèµ°åŠ¿ç›¸å…³çš„è‚¡ç¥¨ã€‚è¿™ä¸¤åªè‚¡ç¥¨çš„ä»·æ ¼å·®è·ä»é•¿æœŸæ¥çœ‹åœ¨ä¸€ä¸ªå›ºå®šçš„æ°´å¹³å†…æ³¢åŠ¨ï¼Œå¦‚æœä»·å·®æš‚æ—¶æ€§çš„è¶…è¿‡æˆ–ä½äºè¿™ä¸ªæ°´å¹³ï¼Œå°±ä¹°å¤šä»·æ ¼åä½çš„è‚¡ç¥¨ï¼Œå–ç©ºä»·æ ¼åé«˜çš„è‚¡ç¥¨ã€‚ç­‰åˆ°ä»·å·®æ¢å¤æ­£å¸¸æ°´å¹³æ—¶ï¼Œè¿›è¡Œå¹³ä»“æ“ä½œï¼Œèµšå–è¿™ä¸€è¿‡ç¨‹ä¸­ä»·å·®å˜åŒ–æ‰€äº§ç”Ÿçš„åˆ©æ¶¦ã€‚<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p>
<h2 id="é€‰å–çš„è‚¡ç¥¨">é€‰å–çš„è‚¡ç¥¨</h2>
<p>æœ¬æ–‡çš„é€‰å–çš„11åªè‚¡ç¥¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">å…¬å¸åç§°</th>
<th style="text-align:center">è‚¡ç¥¨ä»£ç </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">è´µå·èŒ…å°</td>
<td style="text-align:center">600519.SH</td>
</tr>
<tr>
<td style="text-align:center">å±±è¥¿æ±¾é…’</td>
<td style="text-align:center">600809.SH</td>
</tr>
<tr>
<td style="text-align:center">æ´‹æ²³è‚¡ä»½</td>
<td style="text-align:center">002304.SZ</td>
</tr>
<tr>
<td style="text-align:center">ä»Šä¸–ç¼˜</td>
<td style="text-align:center">603369.SH</td>
</tr>
<tr>
<td style="text-align:center">èˆå¾—é…’ä¸š</td>
<td style="text-align:center">600702.SH</td>
</tr>
<tr>
<td style="text-align:center">æ°´äº•åŠ</td>
<td style="text-align:center">600799.SH</td>
</tr>
<tr>
<td style="text-align:center">äº”ç²®æ¶²</td>
<td style="text-align:center">000858.SZ</td>
</tr>
<tr>
<td style="text-align:center">çš‡å°é…’ä¸š</td>
<td style="text-align:center">000995.SZ</td>
</tr>
<tr>
<td style="text-align:center">é…’é¬¼å±‹</td>
<td style="text-align:center">000799.SZ</td>
</tr>
<tr>
<td style="text-align:center">è€ç™½å¹²é…’</td>
<td style="text-align:center">600559.SH</td>
</tr>
<tr>
<td style="text-align:center">ä¼ŠåŠ›ç‰¹</td>
<td style="text-align:center">600197.SH</td>
</tr>
</tbody>
</table>
<h2 id="åæ•´æ€§æ£€éªŒ">åæ•´æ€§æ£€éªŒ</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªè¯»å–è‚¡ç¥¨ä»·æ ¼å¹¶åˆ¤æ–­åæ•´å…³ç³»çš„å‡½æ•°ã€‚è¯¥å‡½æ•°è¿”å›çš„ä¸¤ä¸ªå€¼åˆ†åˆ«ä¸ºåæ•´æ€§æ£€éªŒçš„ <em>p</em> å€¼çŸ©é˜µä»¥åŠæ‰€æœ‰ä¼ å…¥çš„å‚æ•°ä¸­åæ•´æ€§è¾ƒå¼ºçš„è‚¡ç¥¨å¯¹ã€‚ <em>p</em> å€¼è¶Šä½ï¼Œåæ•´å…³ç³»å°±è¶Šå¼ºï¼›<em>p</em> å€¼ä½äº 0.05 æ—¶ï¼Œåæ•´å…³ç³»éå¸¸å¼ºã€‚</p>
<p>åˆ©ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œåæ•´å…³ç³»çš„æ£€éªŒï¼Œå¹¶ç”¨çƒ­åŠ›å›¾æ¥ç›´è§‚å‘ˆç°ç»“æœã€‚</p>
<p>è¯´æ˜ï¼šé¢œè‰²è¶Šçº¢çš„è¡¨ç¤º <em>p</em> å€¼è¶Šå°ï¼Œåˆ™åæ•´å…³ç³»å°±è¶Šå¼ºã€‚</p>
<pre><code class="language-python">import jqdata
import numpy as np
import pandas as pd
import statsmodels.api as sm
import seaborn as sns
import matplotlib.pyplot as plt

def find_cointegrated_pairs(dataframe):
    n = dataframe.shape[1]
    pvalue_matrix = np.ones((n, n))
    keys = dataframe.keys()
    pairs = []
    for i in range(n):
        for j in range(n):
            stock1 = dataframe[keys[i]]
            stock2 = dataframe[keys[j]]
            result = sm.tsa.stattools.coint(stock1, stock2)
            pvalue = result[1]
            pvalue_matrix[i, j] = pvalue
            if pvalue &lt; 0.05:
                pairs.append((keys[i], keys[j], pvalue))
    return pvalue_matrix, pairs
stock_list = [&quot;600519.XSHG&quot;, &quot;600809.XSHG&quot;, &quot;002304.XSHE&quot;, &quot;603369.XSHG&quot;, &quot;600702.XSHG&quot;,
              &quot;600779.XSHG&quot;,&quot;000858.XSHE&quot;, &quot;000995.XSHE&quot;, &quot;000799.XSHE&quot;, &quot;600559.XSHG&quot;,
              &quot;600197.XSHG&quot;]
prices_df = get_price(stock_list,start_date=&quot;2016-01-01&quot;,end_date=&quot;2017-01-01&quot;,fields=&quot;close&quot;)['close']
pvalues, pairs = find_cointegrated_pairs(prices_df)
sns.heatmap(1-pvalues, xticklabels=stock_list, yticklabels=stock_list, cmap='RdYlGn_r', mask = (pvalues == 1),annot=True)
print (pairs)
</code></pre>
<p>ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://i.loli.net/2020/09/13/RNHb4krDmCZYxUJ.png" alt="" loading="lazy"></figure>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œ11åªé…’ç±»è‚¡ç¥¨ä¸­æœ‰10å¯¹ï¼ˆæ¶µç›–*ï¼ˆa,bï¼‰<em>ä¸</em>ï¼ˆb,aï¼‰*ï¼‰å…·æœ‰æ˜¾è‘—çš„åæ•´æ€§å…³ç³»ï¼Œ10å¯¹è‚¡ç¥¨åˆ†åˆ«æ˜¯ï¼š600809â€”600779ï¼›002304â€”000799ï¼›600702â€”000858ï¼›600779â€”000858ï¼›000858â€”600559ï¼›002304â€”603369ï¼›600809â€”600779ï¼›600519â€”600197ï¼›600779â€”600559ï¼›000858â€”600559ã€‚</p>
<p>æ³¨1ï¼šæŒ‰*ï¼ˆx,yï¼‰*é¡ºåºæ’åˆ—</p>
<p>æ³¨2ï¼š<em>coint(a,b)</em> ä¸ç­‰äº <em>coint(b,a)</em>ã€‚</p>
<p>è¿™é‡Œé€‰å–â€œ000858â€”600559â€å³â€œäº”ç²®æ¶²â€”è€ç™½å¹²é…’â€è¿™ä¸€å¯¹è‚¡ç¥¨è¿›è¡Œç ”ç©¶ã€‚</p>
<h2 id="ä»·æ ¼èµ°åŠ¿">ä»·æ ¼èµ°åŠ¿</h2>
<p>åˆ©ç”¨å¦‚ä¸‹ä»£ç å‘ˆç°äº”ç²®æ¶²å’Œè€ç™½å¹²é…’è¿™ä¸¤åªè‚¡ç¥¨çš„ä»·æ ¼èµ°åŠ¿ã€‚</p>
<pre><code class="language-python">stock_df1 = prices_df[&quot;000858.XSHE&quot;]
stock_df2 = prices_df[&quot;600559.XSHG&quot;]
plt.plot(stock_df1); plt.plot(stock_df2)
plt.xlabel(&quot;Time&quot;); plt.ylabel(&quot;Price&quot;)
plt.legend([&quot;000858.XSHE&quot;, &quot;600559.XSHG&quot;],loc='best')
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://i.loli.net/2020/09/13/wk14fOY9Baz8mNJ.png" alt="" loading="lazy"></figure>
<h2 id="olså›å½’">OLSå›å½’</h2>
<p>ç„¶åï¼Œå¯¹ä¸¤åªè‚¡ç¥¨çš„ä»·æ ¼è¿›è¡Œ<em>OLS</em>çº¿æ€§å›å½’ã€‚</p>
<pre><code class="language-python">x=stock_df1
y=stock_df2 
X=sm.add_constant(x)
result=(sm.OLS(y,X)).fit()
print(result.summary())
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://i.loli.net/2020/09/13/6cxQtgVbJsAX8qi.png" alt="" loading="lazy"></figure>
<p>ç”±ä¸Šå›¾å¯çŸ¥ï¼Œç³»æ•°æ˜¯0.5586ï¼Œä¸‹é¢å‘ˆç°çš„æ˜¯æ•°æ®å’Œæ‹Ÿåˆçº¿ã€‚</p>
<pre><code class="language-python">fig, ax = plt.subplots(figsize=(8,6))
ax.plot(x, y, 'o', label=&quot;price&quot;)
ax.plot(x, result.fittedvalues, 'b', label=&quot;OLS&quot;)
ax.legend(loc='upper left')
</code></pre>
<figure data-type="image" tabindex="4"><img src="https://i.loli.net/2020/09/13/J5SDyPuoMOeiZ6K.png" alt="" loading="lazy"></figure>
<p>æ‰€ä»¥ï¼Œå‡è®¾è€ç™½å¹²é…’çš„è‚¡ä»·ä¸º <em>y</em>ï¼Œäº”ç²®æ¶²çš„è‚¡ä»·ä¸º <em>x</em>ï¼Œæ‹Ÿåˆç»“æœï¼š</p>
<p><em>y=5.2179+0.5586</em>x*</p>
<p>å› æ­¤ï¼Œ<em>y-0.5586x</em> æ˜¯å¹³ç¨³åºåˆ—ã€‚</p>
<h2 id="ä»·å·®åºåˆ—">ä»·å·®åºåˆ—</h2>
<p>äºæ˜¯ï¼Œå¯æŒ‰ç…§ä¸Šè¿°æ¯”ä¾‹ï¼Œåšå‡ºäº”ç²®æ¶²å’Œè€ç™½å¹²é…’çš„è‚¡ä»·ä»·å·®çš„å¹³ç¨³åºåˆ—ã€‚</p>
<pre><code class="language-python">plot(stock_df2-0.5586*stock_df1);
plt.axhline((stock_df2-0.5586*stock_df1).mean(), color=&quot;red&quot;, linestyle=&quot;--&quot;)
plt.xlabel(&quot;Time&quot;); plt.ylabel(&quot;Stationary Series&quot;)
plt.legend([&quot;Stationary Series&quot;, &quot;Mean&quot;])
</code></pre>
<figure data-type="image" tabindex="5"><img src="https://i.loli.net/2020/09/13/rBpKdzIWMPRjl98.png" alt="" loading="lazy"></figure>
<p>å›¾ä¸­çš„çº¢çº¿å°±æ˜¯ä¸¤è€…è‚¡ä»·ä»·å·®çš„å‡å€¼ï¼Œå¯è§è™½ç„¶ä»·å·®ä¸Šä¸‹æ³¢åŠ¨ï¼Œä½†æ•´ä½“ä¸Šéƒ½ä¼šå›å½’åˆ°å‡å€¼é™„è¿‘ã€‚</p>
<h2 id="ä½•æ—¶ä¹°ä¸å–">ä½•æ—¶ä¹°ä¸å–</h2>
<p><em>z-score</em> æ˜¯å¯¹æ—¶é—´åºåˆ—åç¦»å…¶å‡å€¼ç¨‹åº¦çš„è¡¡é‡ï¼Œè¡¨ç¤ºæ—¶é—´åºåˆ—åç¦»äº†å…¶å‡å€¼å¤šå°‘å€çš„æ ‡å‡†å·®ã€‚ä¸€ä¸ªåºåˆ—åœ¨æ—¶é—´ <em>t</em> çš„ <em>z-score</em>ï¼Œæ˜¯å®ƒåœ¨æ—¶é—´ <em>t</em> çš„å€¼ï¼Œå‡å»åºåˆ—çš„å‡å€¼ï¼Œå†é™¤ä»¥åºåˆ—çš„æ ‡å‡†å·®åå¾—åˆ°çš„å€¼ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">def zscore(series):
    return (series - series.mean()) / np.std(series)
plot(zscore(stock_df2-0.5586*stock_df1))
plt.axhline(zscore(stock_df2-0.5586*stock_df1).mean(), color=&quot;green&quot;)
plt.axhline(1.0, color=&quot;red&quot;, linestyle=&quot;--&quot;)
plt.axhline(-1.0, color=&quot;yellow&quot;, linestyle=&quot;--&quot;)
plt.legend([&quot;z-score&quot;, &quot;mean&quot;, &quot;+1&quot;, &quot;-1&quot;],loc='upper right')
</code></pre>
<figure data-type="image" tabindex="6"><img src="https://i.loli.net/2020/09/13/qSIbapAk3ynGvgz.png" alt="" loading="lazy"></figure>
<p>å½“ä¸¤ä¸ªåºåˆ—çš„ <em>z-score</em> çªç ´ <em>1</em> æˆ–è€… <em>-1</em> æ—¶ï¼Œè¯´æ˜ä¸¤æ”¯è‚¡ç¥¨çš„ä»·å·®è„±ç¦»äº†ç»Ÿè®¡æ¦‚å¿µä¸­çš„åˆç†åŒºé—´ï¼Œå¦‚æœå®ƒä»¬çš„åæ•´å…³ç³»èƒ½å¤Ÿä¿æŒï¼Œé‚£ä¹ˆå®ƒä»¬çš„ä»·å·®åº”è¯¥æ”¶æ•›ã€‚</p>
<p>å› æ­¤ï¼Œå½“ <em>z-score</em> çªç ´çº¢çº¿æ—¶ï¼Œè¯´æ˜äº”ç²®æ¶²çš„è‚¡ä»·ç›¸å¯¹äºè€ç™½å¹²é…’è¢«é«˜ä¼°ï¼Œæ‰€ä»¥ä¹°å…¥ <em>1</em> ä»½è€ç™½å¹²é…’å¹¶å–ç©º <em>0.5586</em> ä»½äº”ç²®æ¶²çš„è‚¡ç¥¨ï¼Œå½“ <em>z-score</em> å›å½’äº <em>0</em> æ—¶ï¼ˆå›¾ä¸­ç»¿çº¿ï¼‰æ—¶æ¸…ä»“å¯è·åˆ©ã€‚å¦‚æœ <em>z-score</em> çªç ´ä¸‹æ–¹é»„çº¿æ—¶ï¼Œè¯´æ˜äº”ç²®æ¶²çš„è‚¡ä»·ç›¸å¯¹äºè€ç™½å¹²é…’è¢«ä½ä¼°ï¼Œæ‰€ä»¥ä¹°å…¥ <em>1</em> ä»½äº”ç²®æ¶²çš„è‚¡ç¥¨å¹¶å–ç©º <em>1.8</em> ä»½è€ç™½å¹²é…’çš„è‚¡ç¥¨ã€‚</p>
<h2 id="åœ¨aè‚¡å¦‚ä½•å®ç°">åœ¨Aè‚¡å¦‚ä½•å®ç°</h2>
<p>ç”±äºAè‚¡å¸‚åœºæ˜¯ä¸å…è®¸ç›´æ¥å–ç©ºæ“ä½œçš„ï¼Œè€Œèèµ„èåˆ¸åˆå…·æœ‰æ æ†ã€‚å› æ­¤é€€è€Œæ±‚å…¶æ¬¡ï¼Œè‡³è¿›è¡Œåšå¤šæ“ä½œã€‚</p>
<p>é¦–å…ˆï¼Œåˆå§‹çŠ¶æ€èµ„é‡‘é…ç½®ä¸º <em>50%</em> çš„äº”ç²®æ¶²ä¸ <em>50%</em> çš„è€ç™½å¹²é…’ã€‚è®¾ç½® <em>z-score</em> çš„æ£€æµ‹å‘¨æœŸä¸º <em>120</em> å¤©ï¼ˆçº¦åŠå¹´çš„äº¤æ˜“æ—¥ï¼‰ã€‚</p>
<p>æ•´ä½“æ€è·¯ï¼šæ¯ä¸€å¤©æ£€æµ‹ä¸‹ <em>z-score</em>ï¼Œå¦‚æœ  <em>z-score &gt;1</em>ï¼Œåˆ™è°ƒæ•´ä¸ºå…¨ä»“è€ç™½å¹²é…’ï¼›å¦‚æœ <em>z-score &lt; -1</em>ï¼Œåˆ™å…¨ä»“è°ƒæ•´ä¸ºäº”ç²®æ¶²ï¼›å¦‚æœç”± <em>z-score</em> ä»ä¸¤ç«¯è°ƒæ•´è‡³ <em>0</em> ç‚¹ï¼Œåˆ™è°ƒæ•´ä¸ºåˆå§‹é…ç½®æ¯”ä¾‹ã€‚</p>
<pre><code class="language-python">import numpy
import pandas as pd

def initialize(context):
    set_params()
    set_variables()
    set_backtest()
    set_option('ues_real_price',True)
def set_params():
    g.security1=&quot;000858.XSHE&quot;
    g.security2=&quot;600559.XSHG&quot;
    g.benchmark=&quot;000858.XSHE&quot;
    g.regression_ratio=0.5586
    g.p=0.5
    g.q=0.5
    g.test_days=120
def set_variables():
    g.state=&quot;empty&quot;
def set_backtest():
    set_benchmark(g.benchmark)
    log.set_level(&quot;order&quot;,&quot;error&quot;)
    set_option(&quot;use_real_price&quot;, True)
    set_slippage(FixedSlippage(0.))
def handle_data(context, data):
    new_state=get_signal()
    change_positions(new_state,context)
def z_test():
    prices1=np.array(attribute_history(g.security1, g.test_days, '1d', ['close']).close)
    prices2=np.array(attribute_history(g.security2, g.test_days, '1d', ['close']).close)
    stable_series=prices2-g.regression_ratio*prices1
    series_mean=mean(stable_series)
    sigma=np.std(stable_series)
    diff=stable_series[-1]-series_mean
    return(diff/sigma)
def get_signal():
    z_score=z_test
    if z_score &gt; 1:
        return('allbuy2')
    if z_score &lt; -1:
        reutrn('allbuy1')
    if -1 &lt;= z_score &lt;= 1:
        if z_score &gt;= 0:
            return('side1')
        else:
            return('side2')
def change_positions(new_state,context):
    total_value=context.portfolio.portfolio_value
    if new_state == 'allbuy1':
        order_target(g.security2,0)
        order_value(g.security1,total_value)
        g.state='allbuy1'
    if new_state == 'allbuy2':
        order_target(g.security1,0)
        order_value(g.security2,total_value)
        g.state='allbuy2'
    if (g.state == 'allbuy1' and new_state == 'side2') or (g.state == 'allbuy2' and new_state == 'side1'):
        order_target_value(g.security1, g.p*total_value)
        order_target_value(g.security2, g.q*total_value)
        order_target_value(g.security1, g.p*total_value)
        order_target_value(g.security2, g.q*total_value)
        g.state = 'even'
</code></pre>
<p>åœ¨ <em>JoinQuant</em> ä¸Šè¿è¡Œå›æµ‹åï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p>ä»¥äº”ç²®æ¶²ï¼ˆ000858.XSHEï¼‰ä¸ºåŸºå‡†ï¼š</p>
<figure data-type="image" tabindex="7"><img src="https://i.loli.net/2020/09/13/n1Gces3FgaYMAIk.png" alt="" loading="lazy"></figure>
<p>ä»¥è€ç™½å¹²é…’ï¼ˆ600559.XSHGï¼‰ä¸ºåŸºå‡†ï¼š</p>
<p><img src="https://i.loli.net/2020/09/13/n716gizr4O9sJGj.png" alt="" loading="lazy"><br>
å¯è§ï¼Œè¯¥ç­–ç•¥æ¯”å•ç‹¬è´­ä¹°è€ç™½å¹²é…’çš„è‚¡ç¥¨çš„æ”¶ç›Šç‡è¦æ¥å¾—é«˜ï¼Œä½†æ˜¯ä¸å¦‚ç•¥ä½äºåªè´­ä¹°äº”ç²®æ¶²çš„è‚¡ç¥¨çš„æ”¶ç›Šç‡ï¼Œå› æ­¤æœ¬ç­–ç•¥è¿˜æœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´ã€‚</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ç”±äºæœ¬äººåˆæ¬¡å­¦ä¹ é‡åŒ–ç­–ç•¥ï¼Œæœ¬æ–‡ä½œä¸ºæˆ‘å­¦ä¹ çš„ä¸€ä¸ªè®°å½•ï¼Œæœ‰è¯¸å¤šä¸è¶³ä¹‹å¤„æœ›å„ä½æµ·æ¶µã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ol>
<li><a href="https://www.joinquant.net/post/1810?tag=algorithm">ã€é‡åŒ–è¯¾å ‚ã€‘åŸºäºåæ•´çš„æ¬ç –ç­–ç•¥</a></li>
<li><a href="https://www.joinquant.com/post/1731">ã€é‡åŒ–è¯¾å ‚ã€‘åæ•´çš„ç›´è§‚è®¤è¯†</a></li>
<li><a href="https://www.joinquant.com/post/11593?tag=algorithm">æˆ‘å¥½åƒç ´è§£äº†èšå®½æ“‚å°æ’ç¬¬ä¸€çš„ç­–ç•¥ï¼Ÿï¼</a></li>
</ol>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>æ‘˜è‡ªï¼šã€é‡åŒ–è¯¾å ‚ã€‘åŸºäºåæ•´çš„æ¬ç –ç­–ç•¥ <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p>
</li>
</ol>
</section>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E9%80%89%E5%8F%96%E7%9A%84%E8%82%A1%E7%A5%A8">é€‰å–çš„è‚¡ç¥¨</a></li>
<li><a href="#%E5%8D%8F%E6%95%B4%E6%80%A7%E6%A3%80%E9%AA%8C">åæ•´æ€§æ£€éªŒ</a></li>
<li><a href="#%E4%BB%B7%E6%A0%BC%E8%B5%B0%E5%8A%BF">ä»·æ ¼èµ°åŠ¿</a></li>
<li><a href="#ols%E5%9B%9E%E5%BD%92">OLSå›å½’</a></li>
<li><a href="#%E4%BB%B7%E5%B7%AE%E5%BA%8F%E5%88%97">ä»·å·®åºåˆ—</a></li>
<li><a href="#%E4%BD%95%E6%97%B6%E4%B9%B0%E4%B8%8E%E5%8D%96">ä½•æ—¶ä¹°ä¸å–</a></li>
<li><a href="#%E5%9C%A8a%E8%82%A1%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0">åœ¨Aè‚¡å¦‚ä½•å®ç°</a></li>
<li><a href="#%E7%BB%93%E8%AF%AD">ç»“è¯­</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://wengsway.github.io/post/about/">
              <h3 class="post-title">
                å…³äº
              </h3>
            </a>
          </div>
        

        
          

          
            <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css">
<script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>

<div id="disqus_thread"></div>

<script>

var options = {
  shortname: 'wengsway',
  apikey: 'OH3ecd0RzHxNVCLmLoqmcHRDb9Gy40HK10DGjWFAWr6A4i2hx25TsT9O7o5rhOdf',
}
if ('https://disqus.com/api/oauth/2.0/4ab6467b95e54fd387aa938dfe99772c/') {
  options.api = 'https://disqus.com/api/oauth/2.0/4ab6467b95e54fd387aa938dfe99772c/'
}
var dsqjs = new DisqusJS(options)

</script>

          
        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://wengsway.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
