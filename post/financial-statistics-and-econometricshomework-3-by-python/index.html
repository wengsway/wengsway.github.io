<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Financial Statistics and Econometrics：Homework 3 by Python - 泉水叮咚</title>
<link rel="shortcut icon" href="https://wengsway.github.io/favicon.ico">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css">
<link rel="stylesheet" href="https://wengsway.github.io/media/css/tailwind.css">
<link rel="stylesheet" href="https://wengsway.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Financial Statistics and Econometrics：Homework 3 by Python - 泉水叮咚 - Atom Feed" href="https://wengsway.github.io/atom.xml">


  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117938981-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-117938981-1');
  </script>
    

  <meta name="description" content="1.第1问和第2问
Program
# -*- coding: utf-8 -*-
&amp;quot;&amp;quot;&amp;quot;
Created on Tue Nov  6 12:08:07 2018

@author: Wengsway

&amp;qu..." />
  <meta property="og:title" content="Financial Statistics and Econometrics：Homework 3 by Python - 泉水叮咚">
  <meta property="og:description" content="1.第1问和第2问
Program
# -*- coding: utf-8 -*-
&amp;quot;&amp;quot;&amp;quot;
Created on Tue Nov  6 12:08:07 2018

@author: Wengsway

&amp;qu..." />
  <meta property="og:type" content="articles">
  <meta property="og:url" content="https://wengsway.github.io/post/financial-statistics-and-econometricshomework-3-by-python/" />
  <meta property="og:image" content="https://i.loli.net/2020/09/13/z98gHsvi7tKkqbo.jpg">
  <meta property="og:image:height" content="630">
  <meta property="og:image:width" content="1200">
  <meta name="twitter:title" content="Financial Statistics and Econometrics：Homework 3 by Python - 泉水叮咚">
  <meta name="twitter:description" content="1.第1问和第2问
Program
# -*- coding: utf-8 -*-
&amp;quot;&amp;quot;&amp;quot;
Created on Tue Nov  6 12:08:07 2018

@author: Wengsway

&amp;qu...">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="canonical" href="https://wengsway.github.io/post/financial-statistics-and-econometricshomework-3-by-python/">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
 
  
    <link rel="stylesheet" href="https://wengsway.github.io/media/css/prism-atom-dark.css">
  

  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
  
</head>

<body>
  <div class="antialiased flex flex-col min-h-screen" id="app">
    <a href="https://wengsway.github.io" class="fixed top-0 left-0 mt-4 bg-black text-white dark:text-gray-700 dark:bg-yellow-50 dark:hover:bg-black dark:hover:text-white inline-flex p-2 pl-8 hover:text-gray-700 hover:bg-yellow-50 font-bold z-10 transition-fast animated fadeInLeft">
      泉水叮咚
    </a>
    <div class="max-w-4xl w-full mx-auto">
      <div class="shadow-box bg-white dark:bg-gray-600 rounded-lg pt-32 md:pt-64 px-4 md:px-8 pb-8 animated fadeIn mb-8">
        <h1 class="text-5xl font-semibold leading-normal pb-8 mb-8 border-b-8 border-gray-700">
          Financial Statistics and Econometrics：Homework 3 by Python
        </h1>
        
          <img src="https://i.loli.net/2020/09/13/z98gHsvi7tKkqbo.jpg" alt="Financial Statistics and Econometrics：Homework 3 by Python" class="block w-full mb-8">
        
        <div class="mb-8 flex flex-wrap">
          <div class="text-gray-400 text-sm mr-4">2018-11-10 · 25 min read</div>
          
            <a href="https://wengsway.github.io/tag/hgbstBKWi/" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              Finance
            </a>
          
        </div>
        <div class="markdown mb-8" v-pre>
          <h4 id="1第1问和第2问">1.第1问和第2问</h4>
<h5 id="program">Program</h5>
<pre><code class="language-python"># -*- coding: utf-8 -*-
&quot;&quot;&quot;
Created on Tue Nov  6 12:08:07 2018

@author: Wengsway

&quot;&quot;&quot;

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
import statsmodels.api as sm
import warnings

# 1:导入数据并画出波动图
df = pd.read_csv(&quot;000002.csv&quot;,header = None,names = ['date','r'])
plt.plot(df['r'],label = 'r')
plt.hlines(np.mean(df['r']),0,835,colors = 'r',linestyles = &quot;--&quot;,label = 'mean_r')
plt.legend(loc = 'best')
plt.title('Fluctuation Map')
plt.show()

# 2:用 ARMA模型来估计该时间序列
# 2.1:对序列进行平稳性检验
dftest = sm.tsa.stattools.adfuller(df['r'])
dfoutput = pd.Series(dftest[0:4],
                     index=['Test Statistic', 'p-value',
                            '#Lags Used', 'Number of observations Used'])
print(dfoutput)
print('从 ADF 检验结果可知该时间序列是平稳的')

# 2.2：确定AR模型的阶数
# 2.2.1:确定 p
train = df['r'][:-10]# 将数据划分为训练集和测试机
test = df['r'][-10:]
lag_pacf = sm.tsa.stattools.pacf(train, nlags=20, method='ols')
x1 = np.linspace(1,20,20)
plt.plot(x1,lag_pacf[1:],linestyle = '-', marker='o', mec='r')
plt.axhline(y=-(2/np.sqrt(len(df))), linestyle='--', color='gray')
plt.axhline(y=(2/np.sqrt(len(df))), linestyle='--', color='gray')
plt.title('Partial Autocorrelation of r')
plt.xlabel('Lag')
plt.show()
# 2.2.2:画出AR Model
results_AR = sm.tsa.ARMA(train,(11,0)).fit()
plt.plot(train, 'b', label = 'r')
plt.plot(results_AR.fittedvalues, 'r', label = 'AR model')
plt.legend(loc = 'best')
plt.title('The AR Model')
plt.show()
# 2.2.3:展示IC检验结果
aicList = []
bicList = []
hqicList = []
for i in range(1,8):  #从1阶开始算
    order = (i,0)  # 使用ARMA模型，其中MA阶数为0，只考虑了AR阶数。
    ricModel = sm.tsa.ARMA(train,order).fit()
    aicList.append(ricModel.aic)
    bicList.append(ricModel.bic)
    hqicList.append(ricModel.hqic)
plt.plot(aicList,'ro--',label='aic value')
plt.plot(bicList,'bo--',label='bic value')
plt.plot(hqicList,'ko--',label='hqic value')
plt.legend(loc = 'best')
plt.show()
# 2.2.4:AR模型的检验
delta_AR = results_AR.fittedvalues - train # 取得误差项
acf,q,p = sm.tsa.acf(delta_AR,nlags=10,qstat=True)  # 计算自相关系数 及p-value
out_AR = np.c_[range(1,11), acf[1:], q, p]
output_AR = pd.DataFrame(out_AR, columns=['lag', &quot;ACF&quot;, &quot;Q&quot;, &quot;P-value&quot;])
output_AR = output_AR.set_index('lag')
print(output_AR)
print('从白噪声检验结果可以看出误差项接近于白噪声序列')
adjR_AR = 1 - delta_AR.var()/train.var()
print('AR 模型的调整R^2为',adjR_AR)
# 2.2.5:AR模型的预测 
predicts_AR = results_AR.predict(825, 834, dynamic=True) #一共有835个数据
compare_AR = pd.DataFrame()
compare_AR['original'] = test
compare_AR['predict_AR'] = predicts_AR
print('AR Predict results:','\n',compare_AR)
plt.plot(compare_AR['original'],label = 'Original')
plt.plot(compare_AR['predict_AR'],label = 'AR_Predict')
plt.title('AR Model prediction results')
plt.legend(loc = 'best')
plt.show()

# 2.3：确定 MA 模型的阶数 
# 2.3.1:根据 AC 图确定 q 并画出 MA Model
# 确定 q
lag_acf = sm.tsa.stattools.acf(train, nlags=20)
x2 = np.linspace(1,20,20)
plt.plot(x2,lag_acf[1:],linestyle = '-', marker='o', mec='r')
plt.axhline(y=-(2/np.sqrt(len(df))), linestyle='--', color='gray')
plt.axhline(y=(2/np.sqrt(len(df))), linestyle='--', color='gray')
plt.title('Autocorrelation of r')
plt.xlabel('Lag')
plt.show()
# 画出 MA Model 
results_MA = sm.tsa.ARMA(train, (0,11)).fit()
plt.plot(df['r'], 'b', label = 'changepct')
plt.plot(results_MA.fittedvalues, 'r', label = 'MA model')
plt.title('The MA Model')
plt.legend(loc = 'best')
plt.show()
# 2.3.2：MA 模型的预测
predicts_MA = results_MA.predict(825, 834, dynamic=True) #一共有835个数据
compare_MA = pd.DataFrame()
compare_MA['original'] = test
compare_MA['predict_MA'] = predicts_MA
print('MA Predict results:','\n',compare_MA)
plt.plot(compare_MA['original'],label = 'Original')
plt.plot(compare_MA['predict_MA'],label = 'MA_Predict')
plt.title('MA Model prediction results')
plt.legend(loc = 'best')
plt.show()
# 2.3.3：MA 模型的检验
delta_MA = results_MA.fittedvalues - train  # 取得误差项
adjR_MA = 1 - delta_MA.var()/train.var()
print('MA 模型的调整R^2为',adjR_MA)
# 2.4： ARMA Model

warnings.filterwarnings(&quot;ignore&quot;)
AIC_output = sm.tsa.arma_order_select_ic(train,
                                         max_ar=5,
                                         max_ma=5,
                                         ic='aic')['aic_min_order']
print('以 AIC 最小原则选取的 p 和 q:',AIC_output)
BIC_output = sm.tsa.arma_order_select_ic(train,
                                         max_ar=5,
                                         max_ma=5,
                                         ic='bic')['bic_min_order']
print('以 BIC 最小原则选取的 p 和 q:',BIC_output)
HQIC_output = sm.tsa.arma_order_select_ic(train,
                                          max_ar=5,
                                          max_ma=5,
                                          ic='hqic')['hqic_min_order']
print('以 HQIC 最小原则选取的 p 和 q:',HQIC_output)
# 假如以AIC原则为准
results_ARMA_1 = sm.tsa.ARMA(train, (3,2)).fit()
print(results_ARMA_1.summary())
predicts_ARMA_1 = results_ARMA_1.predict(825, 834, dynamic = True)
compare_ARMA_1 = pd.DataFrame()
compare_ARMA_1['original'] = test
compare_ARMA_1['predict_ARMA_1'] = predicts_ARMA_1
print('ARMA(3,2) Predict results:','\n',compare_ARMA_1)
plt.plot(compare_ARMA_1['original'],label = 'Original')
plt.plot(compare_ARMA_1['predict_ARMA_1'],label = 'ARMA_Predict_1')
plt.title('ARMA(3,2) Model prediction results')
plt.legend(loc = 'best')
plt.show()
# ARMA模型的检验
delta_ARMA_1 = results_ARMA_1.fittedvalues - train # 拟合优度检验
adjR_ARMA_1 = 1 - delta_ARMA_1.var()/train.var()
print('ARMA(3,2)模型的调整R^2为',adjR_ARMA_1)
</code></pre>
<h5 id="answer">Answer</h5>
<figure data-type="image" tabindex="1"><img src="https://img.wengsway.com/fluctuation-map.png" alt="" loading="lazy"></figure>
<pre><code class="language-python">Test Statistic                 -29.465798
p-value                          0.000000
#Lags Used                       0.000000
Number of observations Used    834.000000
dtype: float64
从 ADF 检验结果可知该时间序列是平稳的
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://i.loli.net/2020/09/13/QxJPzkoSrZaqpBO.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="3"><img src="https://i.loli.net/2020/09/13/oEAgUYP6qOivzL4.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="4"><img src="https://i.loli.net/2020/09/13/L5NTGopxOPtFmf8.png" alt="" loading="lazy"></figure>
<pre><code class="language-python">           ACF         Q   P-value
lag                               
1.0  -0.000676  0.000378  0.984489
2.0  -0.002286  0.004709  0.997648
3.0   0.003245  0.013448  0.999587
4.0  -0.002859  0.020240  0.999949
5.0  -0.004877  0.040027  0.999983
6.0   0.002683  0.046024  0.999998
7.0  -0.000434  0.046181  1.000000
8.0  -0.001756  0.048756  1.000000
9.0   0.001566  0.050808  1.000000
10.0 -0.002783  0.057293  1.000000
</code></pre>
<p>从白噪声检验结果可以看出误差项接近于白噪声序列</p>
<pre><code class="language-python">AR 模型的调整R^2为 0.021315709346917178
AR Predict results: 
      original  predict_AR
825 -0.002321   -0.000411
826 -0.042345    0.010983
827  0.010690   -0.002776
828 -0.007692    0.004617
829  0.001938    0.005875
830 -0.057060    0.004500
831 -0.031282    0.007006
832  0.026998    0.008854
833 -0.011856    0.003430
834  0.071987    0.004828
</code></pre>
<figure data-type="image" tabindex="5"><img src="https://i.loli.net/2020/09/13/LVslcWUMIFKd1tn.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="6"><img src="https://i.loli.net/2020/09/13/7king3x4HUvToQa.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="7"><img src="https://i.loli.net/2020/09/13/4p5DfMaOb2jCrAI.png" alt="" loading="lazy"></figure>
<pre><code class="language-python">MA Predict results: 
      original  predict_MA
825 -0.002321    0.001475
826 -0.042345    0.012787
827  0.010690    0.000178
828 -0.007692    0.006093
829  0.001938    0.006318
830 -0.057060    0.006718
831 -0.031282    0.007489
832  0.026998    0.009936
833 -0.011856    0.003360
834  0.071987    0.005222
</code></pre>
<figure data-type="image" tabindex="8"><img src="https://i.loli.net/2020/09/13/h6XEPA85kSvB2UC.png" alt="" loading="lazy"></figure>
<pre><code class="language-python">MA 模型的调整R^2为 0.020163754775557208
以 AIC 最小原则选取的 p 和 q: (3, 2)
以 BIC 最小原则选取的 p 和 q: (0, 0)
以 HQIC 最小原则选取的 p 和 q: (0, 0)
                              ARMA Model Results                              
==============================================================================
Dep. Variable:                      r   No. Observations:                  825
Model:                     ARMA(3, 2)   Log Likelihood                1189.512
Method:                       css-mle   S.D. of innovations              0.057
Date:                Wed, 07 Nov 2018   AIC                          -2365.023
Time:                        16:02:57   BIC                          -2332.015
Sample:                             0   HQIC                         -2352.361
                                                                              
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0052      0.002      2.658      0.008       0.001       0.009
ar.L1.r        0.6920      0.035     19.513      0.000       0.622       0.761
ar.L2.r       -0.9454      0.029    -33.123      0.000      -1.001      -0.889
ar.L3.r       -0.0435      0.035     -1.235      0.217      -0.113       0.026
ma.L1.r       -0.7193      0.007   -104.178      0.000      -0.733      -0.706
ma.L2.r        0.9942      0.009    115.048      0.000       0.977       1.011
                                    Roots                                    
=============================================================================
                  Real          Imaginary           Modulus         Frequency
-----------------------------------------------------------------------------
AR.1            0.3765           -0.9384j            1.0111           -0.1893
AR.2            0.3765           +0.9384j            1.0111            0.1893
AR.3          -22.4756           -0.0000j           22.4756           -0.5000
MA.1            0.3617           -0.9354j            1.0029           -0.1913
MA.2            0.3617           +0.9354j            1.0029            0.1913
-----------------------------------------------------------------------------
ARMA(3,2) Predict results: 
      original  predict_ARMA_1
825 -0.002321        0.003338
826 -0.042345        0.006862
827  0.010690        0.006350
828 -0.007692        0.004505
829  0.001938        0.003559
830 -0.057060        0.004671
831 -0.031282        0.006415
832  0.026998        0.006612
833 -0.011856        0.005051
834  0.071987        0.003708
ARMA(3,2)模型的调整R^2为 0.019816685557134783
</code></pre>
<figure data-type="image" tabindex="9"><img src="https://i.loli.net/2020/09/13/Xfa7RwoQmOV8gyZ.png" alt="" loading="lazy"></figure>
<h5 id="program-2">Program</h5>
<pre><code class="language-python"># 得到的结果发现AR(3)的系数不显著，因此尝试ARMA（2，2）。
results_ARMA_2 = sm.tsa.ARMA(train, (2,2)).fit()
print(results_ARMA_2.summary())
predicts_ARMA_2 = results_ARMA_2.predict(825, 834, dynamic = True)
compare_ARMA_2 = pd.DataFrame()
compare_ARMA_2['original'] = test
compare_ARMA_2['predict_ARMA_2'] = predicts_ARMA_2
print('ARMA(2,2) Predict results:','\n',compare_ARMA_2)
plt.plot(compare_ARMA_2['original'],label = 'Original')
plt.plot(compare_ARMA_2['predict_ARMA_2'],label = 'ARMA_Predict_2')
plt.title('ARMA(2,2) Model prediction results')
plt.legend(loc = 'best')
plt.show()
# ARMA模型的检验
delta_ARMA_2 = results_ARMA_2.fittedvalues - train # 拟合优度检验
adjR_ARMA_2 = 1 - delta_ARMA_2.var()/train.var()
print('ARMA(2,2)模型的调整R^2为',adjR_ARMA_2)
</code></pre>
<h5 id="answer-2">Answer</h5>
<pre><code class="language-python">ARMA Model Results                              
==============================================================================
Dep. Variable:                      r   No. Observations:                  825
Model:                     ARMA(2, 2)   Log Likelihood                1201.528
Method:                       css-mle   S.D. of innovations              0.057
Date:                Wed, 07 Nov 2018   AIC                          -2391.057
Time:                        16:10:57   BIC                          -2362.692
Sample:                             0   HQIC                         -2380.182
                                                                              
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0051      0.002      2.546      0.011       0.001       0.009
ar.L1.r        0.4282      0.010     43.140      0.000       0.409       0.448
ar.L2.r       -0.9812      0.008   -124.697      0.000      -0.997      -0.966
ma.L1.r       -0.4336      0.004   -100.860      0.000      -0.442      -0.425
ma.L2.r        1.0000      0.007    148.386      0.000       0.987       1.013
                                    Roots                                    
=============================================================================
                  Real          Imaginary           Modulus         Frequency
-----------------------------------------------------------------------------
AR.1            0.2182           -0.9857j            1.0095           -0.2153
AR.2            0.2182           +0.9857j            1.0095            0.2153
MA.1            0.2168           -0.9762j            1.0000           -0.2152
MA.2            0.2168           +0.9762j            1.0000            0.2152
-----------------------------------------------------------------------------
ARMA(2,2) Predict results: 
      original  predict_ARMA_2
825 -0.002321        0.009458
826 -0.042345        0.008430
827  0.010690        0.002235
828 -0.007692        0.000592
829  0.001938        0.005966
830 -0.057060        0.009880
831 -0.031282        0.006283
832  0.026998        0.000902
833 -0.011856        0.002128
834  0.071987        0.007932
ARMA(2,2)模型的调整R^2为 0.006762936649020834
</code></pre>
<p>ARMA(2,2)模型公式：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>r</mi><mi>t</mi></msub><mo>=</mo><mn>0.0051</mn><mo>+</mo><mn>0.4282</mn><msub><mi>r</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>−</mo><mn>0.9812</mn><msub><mi>r</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>−</mo><mn>0.4336</mn><msub><mi>ε</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>ε</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><msub><mi>ε</mi><mi>t</mi></msub><mspace linebreak="newline"></mspace><mi>z</mi><mo>=</mo><mo>(</mo><mn>2.546</mn><mo>)</mo><mspace width="1em"/><mo>(</mo><mn>43.140</mn><mo>)</mo><mspace width="1em"/><mo>(</mo><mo>−</mo><mn>124.697</mn><mo>)</mo><mspace width="1em"/><mo>(</mo><mo>−</mo><mn>100.860</mn><mo>)</mo><mspace width="1em"/><mo>(</mo><mn>148.386</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">r_t=0.0051+0.4282r_{t-1}-0.9812r_{t-2}-0.4336\varepsilon_{t-1}+\varepsilon_{t-2}+\varepsilon_t\\z=(2.546)\quad(43.140)\quad(-124.697)\quad(-100.860)\quad(148.386)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">5</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.852771em;vertical-align:-0.208331em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">2</span><span class="mord">8</span><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.852771em;vertical-align:-0.208331em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">9</span><span class="mord">8</span><span class="mord">1</span><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.852771em;vertical-align:-0.208331em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">3</span><span class="mord">3</span><span class="mord">6</span><span class="mord"><span class="mord mathdefault">ε</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">ε</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">ε</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">.</span><span class="mord">5</span><span class="mord">4</span><span class="mord">6</span><span class="mclose">)</span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">4</span><span class="mord">3</span><span class="mord">.</span><span class="mord">1</span><span class="mord">4</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mord">2</span><span class="mord">4</span><span class="mord">.</span><span class="mord">6</span><span class="mord">9</span><span class="mord">7</span><span class="mclose">)</span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">.</span><span class="mord">8</span><span class="mord">6</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">4</span><span class="mord">8</span><span class="mord">.</span><span class="mord">3</span><span class="mord">8</span><span class="mord">6</span><span class="mclose">)</span></span></span></span></span></p>
<figure data-type="image" tabindex="10"><img src="https://i.loli.net/2020/09/13/5k3rnhvBUCzuP4i.png" alt="" loading="lazy"></figure>
<h4 id="2第3问至第7问">2.第3问至第7问</h4>
<h5 id="program-3">Program</h5>
<pre><code class="language-python"># -*- coding: utf-8 -*-
&quot;&quot;&quot;
Created on Wed Nov  7 09:33:24 2018

@author: Wengsway

&quot;&quot;&quot;

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import statsmodels.api as sm
import arch

df = pd.read_csv(&quot;000002.csv&quot;,header = None,names = ['date','r'])
# 3:该数列是否具有ARCH效应
# 3.1:根据2建立AR（0）模型
train = df['r'][:-10]# 将数据划分为训练集和测试机
test = df['r'][-10:]
results_AR = sm.tsa.ARMA(train,(0,0)).fit()
delta_AR = train - results_AR.fittedvalues
delta_AR2 = np.square(delta_AR)
plt.subplot(211)
plt.plot(delta_AR,label = 'delta_AR')
plt.legend(loc= 'best')
plt.subplot(212)
plt.plot(delta_AR2,label='delta_AR^2')
plt.legend(loc= 'best')
plt.show()
# 3.2:检验是否有 ARCH 效应
acf,q,p = sm.tsa.acf(delta_AR2,nlags = 15,qstat = True)
out = np.c_[range(1,16),acf[1:],q,p]
output = pd.DataFrame(out,columns = ['lag','AC','Q','P-Value'])
output = output.set_index('lag')
print(output)
print('该数列具有ARCH效应')

# 4:如何确定ARCH效应模型的滞后期并用ARCH模型进行估计
#4.1:确定ARCH效应模型的滞后期
lag_delta_AR2_pacf = sm.tsa.stattools.pacf(delta_AR2, nlags=20)
x3 = np.linspace(1,20,20)
plt.plot(x3,lag_delta_AR2_pacf[1:],linestyle = '-', marker='o', mec='r')
plt.axhline(y=-(2/np.sqrt(len(train))), linestyle='--', color='gray')
plt.axhline(y=(2/np.sqrt(len(train))), linestyle='--', color='gray')
plt.title('Partial Autocorrelation of delta_AR^2')
plt.xlabel('Lag')
plt.show()
# 4.2:用ARCH模型进行估计
results_ARCH = arch.arch_model(train,vol='ARCH',p=2).fit()
print(results_ARCH.summary())
resid2 = np.square(results_ARCH.resid)
plt.plot(resid2,label='ARCH_resid^2')
plt.title('ARCH_resid^2')
plt.show()
# 画出resid2的AC图
lag_resid2_acf = sm.tsa.stattools.acf(resid2,nlags=20)
x4 = np.linspace(1,20,20)
plt.plot(x4,lag_resid2_acf[1:],linestyle = '-', marker='o', mec='r')
plt.axhline(y=-(2/np.sqrt(len(train))), linestyle='--', color='gray')
plt.axhline(y=(2/np.sqrt(len(train))), linestyle='--', color='gray')
plt.title('Autocorrelation of resid2')
plt.xlabel('Lag')
plt.show()
# 画出resid2的PAC图
lag_resid2_pacf = sm.tsa.stattools.pacf(resid2,nlags=20)
x5 = np.linspace(1,20,20)
plt.plot(x5,lag_resid2_pacf[1:],linestyle = '-', marker='o', mec='r')
plt.axhline(y=-(2/np.sqrt(len(train))), linestyle='--', color='gray')
plt.axhline(y=(2/np.sqrt(len(train))), linestyle='--', color='gray')
plt.title('Partial Autocorrelation of resid2')
plt.xlabel('Lag')
plt.show()
'''这一块的预测不知道语句哪里出了问题，截至目前暂未找到解决方法。
# 4.3:用ARCH模型进行预测
predicts_ARCH = results_ARCH.forecast(horizon=10,start = 824)
compare_ARCH = pd.DataFrame()
compare_ARCH['original'] = test
compare_ARCH['predict_ARCH'] = predicts_ARCH
print('ARCH Predict results:','\n',compare_ARCH)
plt.plot(compare_ARCH['original'],label = 'Original')
plt.plot(compare_ARCH['predict_ARCH'],label = 'ARCH_Predict')
plt.title('ARCH Model prediction results')
plt.legend(loc = 'best')
plt.show()
'''

# 5:请用GARCH模型进行估计
results_GARCH = arch.arch_model(train,vol='GARCH',p=1,o=0,q=1).fit()
print(results_GARCH.summary())
results_GARCH.hedgehog_plot()
plt.show()
plt.plot(np.square(results_GARCH.resid),label='GARCH_resid^2')
plt.title('GARCH_resid^2')
plt.show()

# 6:请用TGARCH模型进行估计
results_TGARCH = arch.arch_model(train,p=1,o=1,q=1).fit()
print(results_TGARCH.summary())
results_TGARCH.hedgehog_plot()
plt.show()
plt.plot(np.square(results_TGARCH.resid),label='TGARCH_resid^2')
plt.title('TGARCH_resid^2')
plt.show()
</code></pre>
<h5 id="answer-3">Answer</h5>
<figure data-type="image" tabindex="11"><img src="https://i.loli.net/2020/09/13/U6pjKy8lkMRnhbX.png" alt="" loading="lazy"></figure>
<pre><code class="language-python">            AC           Q       P-Value
lag                                     
1.0   0.102316    8.668003  3.238458e-03
2.0   0.196592   40.708061  1.446628e-09
3.0   0.168014   64.138495  7.666933e-14
4.0   0.105382   73.367460  4.411766e-15
5.0   0.101014   81.857440  3.428514e-16
6.0   0.022819   82.291207  1.200634e-15
7.0   0.116310   93.574563  2.278271e-17
8.0   0.057463   96.332047  2.394152e-17
9.0   0.077603  101.367302  8.321210e-18
10.0  0.066512  105.070758  5.241533e-18
11.0  0.062238  108.317518  3.969318e-18
12.0  0.098957  116.535396  3.025848e-19
13.0  0.098623  124.707967  2.354695e-20
14.0  0.040859  126.112457  3.969334e-20
15.0  0.074878  130.835052  1.459064e-20
该数列具有ARCH效应
</code></pre>
<figure data-type="image" tabindex="12"><img src="https://i.loli.net/2020/09/13/RkWNOwz4AJf3oq8.png" alt="" loading="lazy"></figure>
<pre><code class="language-python">Iteration:      1,   Func. Count:      6,   Neg. LLF: -1204.1577533945233
Iteration:      2,   Func. Count:     18,   Neg. LLF: -1204.3967008380887
Iteration:      3,   Func. Count:     26,   Neg. LLF: -1204.5198231895197
Iteration:      4,   Func. Count:     35,   Neg. LLF: -1204.519930870478
Iteration:      5,   Func. Count:     45,   Neg. LLF: -1204.5199440576448
Iteration:      6,   Func. Count:     53,   Neg. LLF: -1204.5211810050207
Iteration:      7,   Func. Count:     59,   Neg. LLF: -1204.5211831940467
Optimization terminated successfully.    (Exit mode 0)
            Current function value: -1204.521183194039
            Iterations: 7
            Function evaluations: 59
            Gradient evaluations: 7
                      Constant Mean - ARCH Model Results                      
==============================================================================
Dep. Variable:                      r   R-squared:                      -0.001
Mean Model:             Constant Mean   Adj. R-squared:                 -0.001
Vol Model:                       ARCH   Log-Likelihood:                1204.52
Distribution:                  Normal   AIC:                          -2401.04
Method:            Maximum Likelihood   BIC:                          -2382.18
                                        No. Observations:                  825
Date:                Wed, Nov 07 2018   Df Residuals:                      821
Time:                        16:15:56   Df Model:                            4
                                 Mean Model                                 
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
mu         3.8316e-03  1.934e-03      1.981  4.757e-02 [4.103e-05,7.622e-03]
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega      2.4454e-03  3.178e-04      7.695  1.420e-14 [1.823e-03,3.068e-03]
alpha[1]       0.1227  5.547e-02      2.213  2.692e-02   [1.402e-02,  0.231]
alpha[2]       0.1443  5.028e-02      2.870  4.099e-03   [4.577e-02,  0.243]
============================================================================

Covariance estimator: robust
</code></pre>
<figure data-type="image" tabindex="13"><img src="https://i.loli.net/2020/09/13/XasN5tLfIlGTJ6c.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="14"><img src="https://i.loli.net/2020/09/13/PDrc2pGZ1f9WO76.png" alt="" loading="lazy"></figure>
<p><strong>尝试了好多阶的ARCH模型，一直无法修正ARCH效应，但ARCH(2)系数均显著。此处以均值方程为常数，ARCH(2) 为结果。</strong></p>
<p>ARCH(2)模型的公式如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>r</mi><mi>t</mi></msub><mo>=</mo><mn>0.0038</mn><mo>+</mo><msub><mover accent="true"><mi>u</mi><mo stretchy="true">^</mo></mover><mi>t</mi></msub><mspace linebreak="newline"></mspace><mi>t</mi><mo>=</mo><mo>(</mo><mn>1.984</mn><mo>)</mo><mspace linebreak="newline"></mspace><msubsup><mi>σ</mi><mi>t</mi><mn>2</mn></msubsup><mo>=</mo><mn>0.0024</mn><mo>+</mo><mn>0.1227</mn><msubsup><mover accent="true"><mi>u</mi><mo stretchy="true">^</mo></mover><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><mn>2</mn></msubsup><mo>+</mo><mn>0.1443</mn><msubsup><mover accent="true"><mi>u</mi><mo stretchy="true">^</mo></mover><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow><mn>2</mn></msubsup><mspace linebreak="newline"></mspace><mi>t</mi><mo>=</mo><mo>(</mo><mn>7.695</mn><mo>)</mo><mspace width="2em"/><mo>(</mo><mn>2.213</mn><mo>)</mo><mspace width="2em"/><mo>(</mo><mn>2.870</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">r_t=0.0038+\widehat u_t\\t=(1.984)\\\sigma_t^2=0.0024+0.1227\widehat u_{t-1}^2+0.1443\widehat u_{t-2}^2\\t=(7.695)\qquad(2.213)\qquad(2.870)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">3</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8205600000000001em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.67056em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">u</span></span><span class="svg-align" style="width:calc(100% - 0.05556em);margin-left:0.05556em;top:-3.43056em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">9</span><span class="mord">8</span><span class="mord">4</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.1111079999999998em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">2</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1694390000000001em;vertical-align:-0.305331em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mord">2</span><span class="mord">2</span><span class="mord">7</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.67056em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">u</span></span><span class="svg-align" style="width:calc(100% - 0.05556em);margin-left:0.05556em;top:-3.43056em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1694390000000001em;vertical-align:-0.305331em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mord">4</span><span class="mord">4</span><span class="mord">3</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.67056em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">u</span></span><span class="svg-align" style="width:calc(100% - 0.05556em);margin-left:0.05556em;top:-3.43056em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305331em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">7</span><span class="mord">.</span><span class="mord">6</span><span class="mord">9</span><span class="mord">5</span><span class="mclose">)</span><span class="mspace" style="margin-right:2em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">.</span><span class="mord">2</span><span class="mord">1</span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right:2em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">.</span><span class="mord">8</span><span class="mord">7</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></p>
<pre><code class="language-python">Iteration:      1,   Func. Count:      6,   Neg. LLF: -1229.5751372250834
Iteration:      2,   Func. Count:     18,   Neg. LLF: -1230.006965151989
Iteration:      3,   Func. Count:     29,   Neg. LLF: -1230.0332704520888
Iteration:      4,   Func. Count:     36,   Neg. LLF: -1230.3681848149456
Iteration:      5,   Func. Count:     45,   Neg. LLF: -1230.3709021072323
Iteration:      6,   Func. Count:     52,   Neg. LLF: -1230.5382952399789
Iteration:      7,   Func. Count:     60,   Neg. LLF: -1230.5654441845859
Iteration:      8,   Func. Count:     67,   Neg. LLF: -1230.663627391191
Iteration:      9,   Func. Count:     74,   Neg. LLF: -1230.7278889989088
Iteration:     10,   Func. Count:     81,   Neg. LLF: -1230.7373775394299
Iteration:     11,   Func. Count:     88,   Neg. LLF: -1230.7376365561888
Iteration:     12,   Func. Count:     95,   Neg. LLF: -1230.7376481096876
Optimization terminated successfully.    (Exit mode 0)
            Current function value: -1230.7376481031679
            Iterations: 12
            Function evaluations: 106
            Gradient evaluations: 12
                     Constant Mean - GARCH Model Results                      
==============================================================================
Dep. Variable:                      r   R-squared:                      -0.001
Mean Model:             Constant Mean   Adj. R-squared:                 -0.001
Vol Model:                      GARCH   Log-Likelihood:                1230.74
Distribution:                  Normal   AIC:                          -2453.48
Method:            Maximum Likelihood   BIC:                          -2434.61
                                        No. Observations:                  825
Date:                Wed, Nov 07 2018   Df Residuals:                      821
Time:                        16:15:56   Df Model:                            4
                                 Mean Model                                 
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
mu         3.6032e-03  1.827e-03      1.973  4.854e-02 [2.306e-05,7.183e-03]
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega      4.2152e-05  1.351e-05      3.121  1.802e-03 [1.568e-05,6.862e-05]
alpha[1]       0.0360  1.259e-02      2.863  4.201e-03 [1.137e-02,6.073e-02]
beta[1]        0.9517  1.522e-02     62.542      0.000     [  0.922,  0.982]
============================================================================

Covariance estimator: robust
</code></pre>
<figure data-type="image" tabindex="15"><img src="https://i.loli.net/2020/09/13/U3KBe49FRH5jxft.png" alt="" loading="lazy"></figure>
<p><strong>从上图可以看出，GARCH模型的方差还原的效果还可以。</strong></p>
<p>GARCH(1)模型的公式如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>r</mi><mi>t</mi></msub><mo>=</mo><mn>0.0036</mn><mo>+</mo><msub><mover accent="true"><mi>u</mi><mo stretchy="true">^</mo></mover><mi>t</mi></msub><mspace linebreak="newline"></mspace><mi>t</mi><mo>=</mo><mo>(</mo><mn>1.973</mn><mo>)</mo><mspace linebreak="newline"></mspace><msubsup><mi>σ</mi><mi>t</mi><mn>2</mn></msubsup><mo>=</mo><mn>0.036</mn><msubsup><mover accent="true"><mi>u</mi><mo stretchy="true">^</mo></mover><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><mn>2</mn></msubsup><mo>+</mo><mn>0.9517</mn><msubsup><mi>σ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><mn>2</mn></msubsup><mspace linebreak="newline"></mspace><mi>t</mi><mo>=</mo><mo>(</mo><mn>2.863</mn><mo>)</mo><mspace width="2em"/><mo>(</mo><mn>62.542</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">r_t=0.0036+\widehat u_t\\t=(1.973)\\\sigma_t^2=0.036\widehat u_{t-1}^2+0.9517\sigma_{t-1}^2\\t=(2.863)\qquad(62.542)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">3</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8205600000000001em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.67056em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">u</span></span><span class="svg-align" style="width:calc(100% - 0.05556em);margin-left:0.05556em;top:-3.43056em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">9</span><span class="mord">7</span><span class="mord">3</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.1111079999999998em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1694390000000001em;vertical-align:-0.305331em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">3</span><span class="mord">6</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.67056em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">u</span></span><span class="svg-align" style="width:calc(100% - 0.05556em);margin-left:0.05556em;top:-3.43056em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1694390000000001em;vertical-align:-0.305331em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">9</span><span class="mord">5</span><span class="mord">1</span><span class="mord">7</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305331em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">.</span><span class="mord">8</span><span class="mord">6</span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right:2em;"></span><span class="mopen">(</span><span class="mord">6</span><span class="mord">2</span><span class="mord">.</span><span class="mord">5</span><span class="mord">4</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span></p>
<pre><code class="language-python">Iteration:      1,   Func. Count:      7,   Neg. LLF: -1227.7407305056854
Iteration:      2,   Func. Count:     20,   Neg. LLF: -1228.263982437867
Iteration:      3,   Func. Count:     30,   Neg. LLF: -1228.413993877993
Iteration:      4,   Func. Count:     41,   Neg. LLF: -1228.4180131947087
Iteration:      5,   Func. Count:     54,   Neg. LLF: -1228.5023007917416
Iteration:      6,   Func. Count:     63,   Neg. LLF: -1228.7323280890687
Iteration:      7,   Func. Count:     76,   Neg. LLF: -1228.7326268528036
Iteration:      8,   Func. Count:     89,   Neg. LLF: -1228.732632102148
Iteration:      9,   Func. Count:    101,   Neg. LLF: -1228.732751211943
Iteration:     10,   Func. Count:    113,   Neg. LLF: -1229.334557375506
Iteration:     11,   Func. Count:    125,   Neg. LLF: -1229.359889432208
Iteration:     12,   Func. Count:    135,   Neg. LLF: -1229.6628944968922
Iteration:     13,   Func. Count:    144,   Neg. LLF: -1229.7292233241137
Iteration:     14,   Func. Count:    151,   Neg. LLF: -1233.5840199489767
Iteration:     15,   Func. Count:    160,   Neg. LLF: -1235.1398071417655
Iteration:     16,   Func. Count:    169,   Neg. LLF: -1235.1998797103008
Iteration:     17,   Func. Count:    177,   Neg. LLF: -1235.6319255746955
Iteration:     18,   Func. Count:    184,   Neg. LLF: -1236.0054400949457
Iteration:     19,   Func. Count:    191,   Neg. LLF: -1236.1198537612077
Iteration:     20,   Func. Count:    198,   Neg. LLF: -1236.1411202229565
Iteration:     21,   Func. Count:    205,   Neg. LLF: -1236.1437339615147
Iteration:     22,   Func. Count:    212,   Neg. LLF: -1236.1438561196142
Iteration:     23,   Func. Count:    219,   Neg. LLF: -1236.1438829462534
Optimization terminated successfully.    (Exit mode 0)
            Current function value: -1236.143882945769
            Iterations: 26
            Function evaluations: 219
            Gradient evaluations: 23
                   Constant Mean - GJR-GARCH Model Results                    
==============================================================================
Dep. Variable:                      r   R-squared:                      -0.000
Mean Model:             Constant Mean   Adj. R-squared:                 -0.000
Vol Model:                  GJR-GARCH   Log-Likelihood:                1236.14
Distribution:                  Normal   AIC:                          -2462.29
Method:            Maximum Likelihood   BIC:                          -2438.71
                                        No. Observations:                  825
Date:                Wed, Nov 07 2018   Df Residuals:                      820
Time:                        16:15:57   Df Model:                            5
                                 Mean Model                                 
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
mu         4.6352e-03  2.097e-03      2.210  2.710e-02 [5.246e-04,8.746e-03]
                               Volatility Model                              
=============================================================================
                 coef    std err          t      P&gt;|t|       95.0% Conf. Int.
-----------------------------------------------------------------------------
omega      3.2223e-05  5.937e-06      5.428  5.703e-08  [2.059e-05,4.386e-05]
alpha[1]       0.0422  1.046e-02      4.034  5.488e-05  [2.168e-02,6.267e-02]
gamma[1]      -0.0322  2.400e-02     -1.758  7.881e-02 [-8.921e-02,4.855e-03]
beta[1]        0.9679  1.568e-02     61.748      0.000      [  0.937,  0.999]
=============================================================================

Covariance estimator: robust
</code></pre>
<figure data-type="image" tabindex="16"><img src="https://raw.githubusercontent.com/wengsway/Graphbed/master/img/r-volatility-forecast-hedgehog-plot-tgarch.png" alt="" loading="lazy"></figure>
<p>TGARCH(1)模型的公式如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>r</mi><mi>t</mi></msub><mo>=</mo><mn>0.0046</mn><mo>+</mo><msub><mover accent="true"><mi>u</mi><mo stretchy="true">^</mo></mover><mi>t</mi></msub><mspace linebreak="newline"></mspace><mi>t</mi><mo>=</mo><mo>(</mo><mn>2.210</mn><mo>)</mo><mspace linebreak="newline"></mspace><msubsup><mi>σ</mi><mi>t</mi><mn>2</mn></msubsup><mo>=</mo><mn>0.0422</mn><msubsup><mover accent="true"><mi>u</mi><mo stretchy="true">^</mo></mover><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><mn>2</mn></msubsup><mo>−</mo><mn>0.0322</mn><msubsup><mover accent="true"><mi>u</mi><mo stretchy="true">^</mo></mover><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><mn>2</mn></msubsup><msub><mi>d</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mn>0.9679</mn><msubsup><mi>σ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><mn>2</mn></msubsup><mspace linebreak="newline"></mspace><mi>t</mi><mo>=</mo><mo>(</mo><mn>4.034</mn><mo>)</mo><mspace width="2em"/><mo>(</mo><mo>−</mo><mn>1.758</mn><mo>)</mo><mspace width="2em"/><mo>(</mo><mn>61.748</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">r_t=0.0046+\widehat u_t\\t=(2.210)\\\sigma_t^2=0.0422\widehat u_{t-1}^2-0.0322\widehat u_{t-1}^2d_{t-1}+0.9679\sigma_{t-1}^2\\t=(4.034)\qquad(-1.758)\qquad(61.748)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">4</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8205600000000001em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.67056em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">u</span></span><span class="svg-align" style="width:calc(100% - 0.05556em);margin-left:0.05556em;top:-3.43056em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">.</span><span class="mord">2</span><span class="mord">1</span><span class="mord">0</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.1111079999999998em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1694390000000001em;vertical-align:-0.305331em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">4</span><span class="mord">2</span><span class="mord">2</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.67056em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">u</span></span><span class="svg-align" style="width:calc(100% - 0.05556em);margin-left:0.05556em;top:-3.43056em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1694390000000001em;vertical-align:-0.305331em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">3</span><span class="mord">2</span><span class="mord">2</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.67056em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">u</span></span><span class="svg-align" style="width:calc(100% - 0.05556em);margin-left:0.05556em;top:-3.43056em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305331em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1694390000000001em;vertical-align:-0.305331em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">9</span><span class="mord">6</span><span class="mord">7</span><span class="mord">9</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305331em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">4</span><span class="mord">.</span><span class="mord">0</span><span class="mord">3</span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:2em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mord">.</span><span class="mord">7</span><span class="mord">5</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:2em;"></span><span class="mopen">(</span><span class="mord">6</span><span class="mord">1</span><span class="mord">.</span><span class="mord">7</span><span class="mord">4</span><span class="mord">8</span><span class="mclose">)</span></span></span></span></span></p>
<p>对模型的评价：在上述模型中，非对称效应项的系数 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span></span></span></span> 显著不等于零，说明 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>r</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">r_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的波动具有非对称效应。因为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>γ</mi><mo>=</mo><mo>−</mo><mn>0.0322</mn></mrow><annotation encoding="application/x-tex">\gamma=-0.0322</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">3</span><span class="mord">2</span><span class="mord">2</span></span></span></span>，大于零，说明“好消息”能比“坏消息”产生更大的波动。当出现“好消息”时，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">u_{t-1}&gt;0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.747431em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> ，则<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">d_{t-1}=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> ，所以该冲击会给 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>r</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">r_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 带来一个<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>α</mi><mn>1</mn></msub><mo>=</mo><mn>0.0422</mn></mrow><annotation encoding="application/x-tex">\alpha_1=0.0422</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">4</span><span class="mord">2</span><span class="mord">2</span></span></span></span> 倍的冲击，而出现“坏消息”时，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">u_{t-1}&lt;0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.747431em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> ，则<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">d_{t-1}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> ，则“坏消息”会给 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>r</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">r_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 带来一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>α</mi><mn>1</mn></msub><mo>+</mo><mi>γ</mi><mo>=</mo><mn>0.01</mn></mrow><annotation encoding="application/x-tex">\alpha_1+\gamma=0.01</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">1</span></span></span></span> 倍的冲击。</p>
<figure data-type="image" tabindex="17"><img src="https://raw.githubusercontent.com/wengsway/Graphbed/master/img/arch-resid2.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="18"><img src="https://raw.githubusercontent.com/wengsway/Graphbed/master/img/garch-resid2.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="19"><img src="https://raw.githubusercontent.com/wengsway/Graphbed/master/img/tgarch-resid2.png" alt="" loading="lazy"></figure>
<p><strong>预测收益率：我将数据划分为训练集和测试集，根据训练集的数据进行建模然后取测试集中的数据进行检验测试的效果。</strong></p>

        </div>
        <!-- Share to Twitter, Weibo, Telegram -->
        <div class="flex items-center">
          <div class="mr-4 flex items-center">
            <i class="ri-share-forward-line text-gray-500"></i>
          </div>
          <div class="px-4 cursor-pointer text-blue-500 hover:bg-blue-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTwitter">
            <i class="ri-twitter-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-red-500 hover:bg-red-100 dark:hover:bg-gray-600 inline-flex" @click="shareToWeibo">
            <i class="ri-weibo-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-indigo-500 hover:bg-indigo-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTelegram">
            <i class="ri-telegram-line"></i>
          </div>
        </div>
      </div>

      
        

        
          <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css">
<script type="application/javascript" src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>

<div id="disqus_thread"></div>

<script type="application/javascript">

var options = {
  shortname: 'wengsway',
  apikey: 'OH3ecd0RzHxNVCLmLoqmcHRDb9Gy40HK10DGjWFAWr6A4i2hx25TsT9O7o5rhOdf',
}
if ('https://disqus.com/api/oauth/2.0/4ab6467b95e54fd387aa938dfe99772c/') {
  options.api = 'https://disqus.com/api/oauth/2.0/4ab6467b95e54fd387aa938dfe99772c/'
}
var dsqjs = new DisqusJS(options)

</script>

        
      

      

      <footer class="py-12 text-center px-4 md:px-0" v-pre>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank"> Gridea</a>
</footer>
    </div>

    <!-- TOC Container -->
    <div class="fixed right-0 bottom-0 mb-16 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white dark:bg-gray-500 dark:text-gray-200 hover:shadow-lg transition-all animated fadeInRight" @click="showToc = true">
      <i class="ri-file-list-line"></i>
    </div>

    <div class="fixed right-0 top-0 bottom-0 overflow-y-auto w-64 bg-white dark:bg-gray-800 p-4 border-l border-gray-100 dark:border-gray-600 z-10 transition-fast" :class="{ '-mr-64': !showToc }">
      <div class="flex mb-4 justify-end">
        <div class="w-8 h-8 inline-flex justify-center items-center rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-fast" @click="showToc = false">
          <i class="ri-close-line text-lg"></i>
        </div>
      </div>
      <div class="post-toc-container">
        <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#1%E7%AC%AC1%E9%97%AE%E5%92%8C%E7%AC%AC2%E9%97%AE">1.第1问和第2问</a>
<ul>
<li><a href="#program">Program</a></li>
<li><a href="#answer">Answer</a></li>
<li><a href="#program-2">Program</a></li>
<li><a href="#answer-2">Answer</a></li>
</ul>
</li>
<li><a href="#2%E7%AC%AC3%E9%97%AE%E8%87%B3%E7%AC%AC7%E9%97%AE">2.第3问至第7问</a>
<ul>
<li><a href="#program-3">Program</a></li>
<li><a href="#answer-3">Answer</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      </div>
    </div>

    <!-- Back to top -->
    <div class="fixed right-0 bottom-0 mb-4 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white hover:shadow-lg transition-all dark:bg-gray-500 dark:text-gray-200" @click="backToUp" v-show="scrolled">
      <i class="ri-arrow-up-line"></i>
    </div>
  </div>

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg">
  </div>
  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
    </div>
    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->
        <div class="pswp__counter">
        </div>
        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip">
        </div>
      </div>
      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
      </button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
      </button>
      <div class="pswp__caption">
        <div class="pswp__caption__center">
        </div>
      </div>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://wengsway.github.io/media/scripts/main.js"></script>
  
  <!-- Code Highlight -->
  
    <script src="https://wengsway.github.io/media/prism.js"></script>
    <script>
      Prism.highlightAll()
    </script>
  

  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>
  <script>
    //拿到预览框架，也就是上面的html代码
    var pswpElement = document.querySelectorAll('.pswp')[0];
    //定义图片数组变量
    var imgitems;
    /**
    * 用于显示预览界面
    * @param index 图片数组下标
    */
    function viewImg(index) {
      //其它选项这里不做过多阐述，详情见官网
      var pswpoptions = {
        index: parseInt(index, 10), // 开始幻灯片索引。0是第一张幻灯片。必须是整数，而不是字符串。
        bgOpacity: 0.7, // 背景透明度，0-1
        maxSpreadZoom: 3, // 缩放级别，不要太大
      };
      //初始化并打开PhotoSwipe，pswpElement对应上面预览框架，PhotoSwipeUI_Default为皮肤，imgitems为图片数组，pswpoptions为选项
      var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, imgitems, pswpoptions);
      gallery.init()
    }
    /**
    * 用于添加图片点击事件
    * @param img 图片元素
    * @param index 所属下标（在imgitems中的位置）
    */
    function addImgClick(img, index) {
      img.onclick = function() {
        viewImg(index)
      }
    }
    /**
    * 轮询所有图片，获取src、width、height等数据，加入imgitems，并给图片元素添加事件
    * 最好在onload中执行该方法，本站因放在最底部，所以直接初始化
    * 异步加载图片可在图片元素创建完成后调用此方法
    */
    function initImg() {
      //重置图片数组
      imgitems = [];
      //查找class:markdown 下的所有img元素并遍历
      var imgs = document.querySelectorAll('.markdown img');
      for (var i = 0; i < imgs.length; i++) {
        var img = imgs[i];
        //本站相册初始为loading图片，真实图片放在data-src
        var ds = img.getAttribute("data-src");
        //创建image对象，用于获取图片宽高
        var imgtemp = new Image();
        //判断是否存在data-src
        if (ds != null && ds.length > 0) {
          imgtemp.src = ds
        } else {
          imgtemp.src = img.src
        }
        //判断是否存在缓存
        if (imgtemp.complete) {
          var imgobj = {
            "src": imgtemp.src,
            "w": imgtemp.width,
            "h": imgtemp.height,
          };
          imgitems[i] = imgobj;
          addImgClick(img, i);
        } else {
          console.log('进来了2')
          imgtemp.index = i;
          imgtemp.img = img;
          imgtemp.onload = function() {
            var imgobj = {
              "src": this.src,
              "w": this.width,
              "h": this.height,
            };
            //不要使用push，因为onload前后顺序会不同
            imgitems[this.index] = imgobj
            //添加点击事件
            addImgClick(this.img, this.index);
          }
        }
      }
    }
    //初始化
    initImg();
  </script>
  
  
    
  
</body>

</html>